name:  Terraform AWS

on:
  workflow_dispatch:

jobs:
  terraform:
    runs-on:  ubuntu-latest

  steps:
  - name: checkout code
    uses: actions/checkout@v3

  - name: install and config aws
    uses: actions/configure-aws-credentials@v2
    with:
      aws-access-key-id: ${{secrets.AWS_ACCESS_KEY_ID}}
      aws-secret-access-key: ${{secrets.AWS_SECRET_ACCESS_KEY}}
      aws-session-token: ${{AWS_SESSION_TOKEN}}
      aws-region: us-east-1

  - name: setup terraform
    uses: hashicorp/setup-terraform@v2
    with:
      terraform_version:1.10.5

  - name: run Terraform init
    run: 
      terraform init

  - name: run Terraform validate
    run: 
      terraform validate

  - name: run Terraform apply
    run: 
      terraform apply -auto-approve 
